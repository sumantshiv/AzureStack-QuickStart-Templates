{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "clusterName": {
            "type": "string",
            "metadata": {
                "description": "Name of your cluster - Between 3 and 23 characters. Letters and numbers only"
            }
        },
        "instanceCount": {
            "type": "int",
            "metadata": {
                "description": "Size of the VM scale set (Min 5 and Max 100)."
            },
            "defaultValue": 5,
            "minValue": 5,
            "maxValue": 100
        },
        "vmNodeTypeName": {
            "type": "string",
            "defaultValue": "Type01",
            "maxLength": 9,
            "metadata": {
                "description": "Service fabric node type name. Also used for VM scaleset name prefix."
            }
        },
        "vmImagePublisher": {
            "type": "string",
            "defaultValue": "MicrosoftWindowsServer"
        },
        "vmImageOffer": {
            "type": "string",
            "defaultValue": "WindowsServer"
        },
        "vmImageSku": {
            "type": "string",
            "defaultValue": "2016-Datacenter"
        },
        "vmImageVersion": {
            "type": "string",
            "defaultValue": "latest"
        },
        "vmNodeSize": {
            "type": "string",
            "allowedValues": [
                "Standard_D1_v2",
                "Standard_D2_v2",
                "Standard_D3_v2",
                "Standard_D4_v2",
                "Standard_D5_v2",
                "Standard_D11_v2",
                "Standard_D12_v2",
                "Standard_D13_v2",
                "Standard_D14_v2",
                "Standard_DS1_v2",
                "Standard_DS2_v2",
                "Standard_DS3_v2",
                "Standard_DS4_v2",
                "Standard_DS5_v2",
                "Standard_DS11_v2",
                "Standard_DS12_v2",
                "Standard_DS13_v2",
                "Standard_DS14_v2"
            ],
            "defaultValue": "Standard_D2_v2"
        },
        "adminUserName": {
            "type": "string",
            "metadata": {
                "description": "Remote desktop user Id."
            }
        },
        "adminPassword": {
            "type": "securestring",
            "metadata": {
                "description": "Remote desktop user password. Must be a strong password."
            }
        },
        "addressPrefix": {
            "type": "string",
            "defaultValue": "10.0.0.0/16",
            "metadata": {
                "description": "The address prefix for the cluster’s  virtual network."
            }
        },
        "subnetPrefix": {
            "type": "string",
            "defaultValue": "10.0.0.0/24",
            "metadata": {
                "description": "The address prefix for the cluster’s subnet in the virtual network. "
            }
        },
        "servicefabricTcpGatewayPort": {
            "type": "int",
            "defaultValue": 19000,
            "metadata": {
                "description": "Service Fabric cluster TCP gateway port to be used to connect using service fabric client."
            }
        },
        "servicefabricHttpGatewayPort": {
            "type": "int",
            "defaultValue": 19080,
            "metadata": {
                "description": "Service Fabric cluster HTTP gateway port to be used to connect using service fabric explorer."
            }
        },
        "servicefabricReverseProxyEndpointPort": {
            "type": "int",
            "defaultValue": 19081,
            "metadata": {
                "description": "Service Fabric cluster reverse proxy port."
            }
        },
        "lbApplicationPorts": {
            "type": "array",
            "defaultValue": [],
            "metadata": {
                "description": "Array of application ports to be opened (like [80, 8080, 8081])."
            }
        },
        "certBlobCloudName": {
            "type": "string",
            "defaultValue": "AzureCloud"
        },
        "certBlobAccountName": {
            "type": "string"
        },
        "certBlobSASKey": {
            "type": "string"
        },
        "certBlobContainerName": {
            "type": "string"
        },
        "clusterCertificateName": {
            "type": "string"
        },
        "clusterCertificatePassword": {
            "type": "securestring"
        },
        "certificateThumbprint": {
            "type": "string",
            "metadata": {
                "description": "Certificate Thumbprint"
            }
        },
        "reverseProxyCertificateName": {
            "type": "string",
            "defaultValue": ""
        },
        "reverseProxyCertificatePassword": {
            "type": "securestring",
            "defaultValue": ""
        },
        "reverseProxyCertificateThumbprint": {
            "type": "string",
            "defaultValue": "",
            "metadata": {
                "description": "Reverse proxy Certificate Thumbprint"
            }
        },
        "adminClientCertificateThumbprint": {
            "type": "array",
            "defaultValue": [],
            "metadata": {
                "description": "Admin client Certificate Thumbprint"
            }
        },
        "nonAdminClientCertificateThumbprint": {
            "type": "array",
            "defaultValue": [],
            "metadata": {
                "description": "Non-Admin client Certificate Thumbprint"
            }
        },
        "DNSService": {
            "type": "string",
            "allowedValues": [
                "Yes",
                "No"
            ],
            "defaultValue": "No",
            "metadata": {
                "description": "DNS Service Optional Feature"
            }
        },
        "RepairManager": {
            "type": "string",
            "allowedValues": [
                "Yes",
                "No"
            ],
            "defaultValue": "No",
            "metadata": {
                "description": "Repair Manager Optional Feature"
            }
        },
        "serviceFabricUrl": {
            "type": "string",
            "metadata": {
                "description": "Service fabric runtime download url."
            },
            "defaultValue": "http://go.microsoft.com/fwlink/?LinkId=730690"
        },
        "scriptBaseUrl": {
            "type": "string",
            "metadata": {
                "description": "Scripts base url"
            },
            "defaultValue": "[deployment().properties.templateLink.uri]"
        }
    },
    "variables": {

        "apiVersion": {
            "vmssApiVersion": "2016-03-30",
            "lbApiVersion": "2015-06-15",
            "vNetApiVersion": "2015-06-15",
            "storageApiVersion": "2016-01-01",
            "publicIPApiVersion": "2015-06-15",
            "templateDeploymentApiVersion": "2015-01-01"
        },

        "location": "[resourceGroup().location]",
        "uniquePrefix": "[uniqueString(resourceGroup().id)]",
        "virtualNetworkName": "[concat(variables('uniquePrefix'), 'vnet')]",
        "vnetID": "[resourceId('Microsoft.Network/virtualNetworks',variables('virtualNetworkName'))]",
        "nicName": "[concat(variables('uniquePrefix'), 'nic')]",
        "ipConfigName": "[concat(variables('uniquePrefix'), 'ipconfig')]",
        "lbName": "[concat(variables('uniquePrefix'), 'lb')]",
        "lbID": "[resourceId('Microsoft.Network/loadBalancers', variables('lbName'))]",
        "lbIPName": "[concat(variables('uniquePrefix'), 'pip')]",
        "lbPublicIPID": "[resourceId('Microsoft.Network/publicIPAddresses',variables('lbIPName'))]",
        "subnetName": "[concat(variables('uniquePrefix'), 'subnet')]",
        "natPoolName": "[concat(variables('uniquePrefix'), 'natpool')]",
        "bePoolName": "[concat(variables('uniquePrefix'), 'bepool')]",
        "dnsLabel": "[tolower(parameters('clusterName'))]",
        "diagStoreAccountName": "[toLower(concat('diagSA', uniqueString(resourceGroup().id)))]",
        "ephemeralStartPort": 49152,
        "ephemeralEndPort": 65534,
        "applicationStartPort": 20000,
        "applicationEndPort": 30000,
        "lbPortsArray": "[concat(array(parameters('servicefabricTcpGatewayPort')), array(parameters('servicefabricHttpGatewayPort')), parameters('lbApplicationPorts'))]",
        "certificateStoreValue": "My",

        "imageConfig": {
            "vmssUniqueName": "[concat(variables('uniquePrefix'), 'vmss')]",
            "vmImagePublisher": "[parameters('vmImagePublisher')]",
            "vmImageOffer": "[parameters('vmImageOffer')]",
            "vmImageVersion": "[parameters('vmImageVersion')]",
            "vhdContainerName": "[concat(variables('uniquePrefix'), 'vhd')]",
            "osDiskName": "[concat(variables('uniquePrefix'), 'osdisk')]",
            "overProvision": "false",
            "storageAccountName": "[toLower(concat('SA', uniqueString(resourceGroup().id)))]",
            "storageAccountType": "Standard_LRS"
        },

        "derivedIds": {
            "subnetID": "[concat(variables('vnetID'),'/subnets/',variables('subnetName'))]",
            "lbIPConfigID": "[concat(variables('lbID'),'/frontendIPConfigurations/LoadBalancerIPConfig')]",
            "lbPoolID": "[concat(variables('lbID'),'/backendAddressPools/', variables('bePoolName'))]",
            "lbNatPoolID": "[concat(variables('lbID'),'/inboundNatPools/', variables('natPoolName'))]",
            "lbGatewayProbeID": "[concat(variables('lbID'),'/probes/FabricGatewayProbe')]",
            "lbHttpProbeID": "[concat(variables('lbID'),'/probes/FabricHttpGatewayProbe')]"
        },

        "sfDeploymentTemplateURL": "[uri(parameters('scriptBaseUrl'), 'deploySFCluster.json')]",
        "scriptName": "PrepareServiceFabricDeployment.ps1",
        "serviceFabricPrepareScriptUrl": "[uri(parameters('scriptBaseUrl'), variables('scriptName'))]",

        "keyParam": "[concat(' -StorageAccessKey ', parameters('certBlobSASKey') )]",
        "envParam": "[concat(' -EnvironmentName ', parameters('certBlobCloudName') )]",
        "storageAcct": "[concat(' -StorageAccountName ', parameters('certBlobAccountName') )]",
        "containerParam": "[concat(' -ContainerName ', parameters('certBlobContainerName') )]",
        "clusterCertNameParam": "[concat(' -ClusterCertName ', parameters('clusterCertificateName') )]",
        "clusterCertPasswordParam": "[concat(' -ClusterCertPassword ', parameters('clusterCertificatePassword') )]",
        "clusterCertThumbprintParam": "[concat(' -CertificateThumbprint ', parameters('certificateThumbprint') )]",

        "reverseProxyCertNameParam": "[concat(' -ReverseProxyCertName ', parameters('reverseProxyCertificateName') )]",
        "reverseProxyCertPasswordParam": "[concat(' -ReverseProxyCertPassword ', parameters('reverseProxyCertificatePassword') )]",
        "reverseProxyCertThumbprintParam": "[concat(' -ReverseProxyCertificateThumbprint ', parameters('reverseProxyCertificateThumbprint') )]",
        "commandParam0": "[concat(variables('keyParam'), variables('envParam'), variables('storageAcct'), variables('containerParam'), variables('clusterCertNameParam'), variables('clusterCertPasswordParam'), variables('clusterCertThumbprintParam'))]",

        "commandParam1": "[if(equals(parameters('reverseProxyCertificateName'), ''), variables('commandParam0'), concat(variables('commandParam0'), variables('reverseProxyCertNameParam')))]",
        "commandParam2": "[if(equals(parameters('reverseProxyCertificatePassword'), ''), variables('commandParam1'), concat(variables('commandParam1'), variables('reverseProxyCertPasswordParam')))]",
        "commandParam": "[if(equals(parameters('reverseProxyCertificateThumbprint'), ''), variables('commandParam2'), concat(variables('commandParam2'), variables('reverseProxyCertThumbprintParam')))]"
    },
    "resources": [
        {
            "type": "Microsoft.Storage/storageAccounts",
            "name": "[variables('imageConfig').storageAccountName]",
            "apiVersion": "[variables('apiVersion').storageApiVersion]",
            "location": "[variables('location')]",
            "sku": {
                "name": "[variables('imageConfig').storageAccountType]"
            },
            "kind": "Storage"
        },
        {
            "type": "Microsoft.Storage/storageAccounts",
            "name": "[variables('diagStoreAccountName')]",
            "apiVersion": "[variables('apiVersion').storageApiVersion]",
            "location": "[variables('location')]",
            "sku": {
                "name": "[variables('imageConfig').storageAccountType]"
            },
            "kind": "Storage"
        },
        {
            "apiVersion": "[variables('apiVersion').vNetApiVersion]",
            "type": "Microsoft.Network/virtualNetworks",
            "name": "[variables('virtualNetworkName')]",
            "location": "[variables('location')]",
            "dependsOn": [],
            "properties": {
                "addressSpace": {
                    "addressPrefixes": [
                        "[parameters('addressPrefix')]"
                    ]
                },
                "subnets": [
                    {
                        "name": "[variables('subnetName')]",
                        "properties": {
                            "addressPrefix": "[parameters('subnetPrefix')]"
                        }
                    }
                ]
            },
            "tags": {
                "resourceType": "Service Fabric",
                "clusterName": "[parameters('clusterName')]",
                "displayName": "VirtualNetwork"
            }
        },
        {
            "apiVersion": "[variables('apiVersion').publicIPApiVersion]",
            "type": "Microsoft.Network/publicIPAddresses",
            "name": "[variables('lbIPName')]",
            "location": "[variables('location')]",
            "dependsOn": [
                "[variables('vnetID')]"
            ],
            "properties": {
                "dnsSettings": {
                    "domainNameLabel": "[variables('dnsLabel')]"
                },
                "publicIPAllocationMethod": "Dynamic"
            },
            "tags": {
                "resourceType": "Service Fabric",
                "clusterName": "[parameters('clusterName')]",
                "displayName": "PublicIP"
            }
        },
        {
            "apiVersion": "[variables('apiVersion').lbApiVersion]",
            "type": "Microsoft.Network/loadBalancers",
            "name": "[variables('lbName')]",
            "location": "[variables('location')]",
            "dependsOn": [
                "[variables('lbPublicIPID')]"
            ],
            "properties": {
                "frontendIPConfigurations": [
                    {
                        "name": "LoadBalancerIPConfig",
                        "properties": {
                            "publicIPAddress": {
                                "id": "[variables('lbPublicIPID')]"
                            }
                        }
                    }
                ],
                "backendAddressPools": [
                    {
                        "name": "[variables('bePoolName')]"
                    }
                ],
                "copy": [
                    {
                        "name": "loadBalancingRules",
                        "count": "[length(variables('lbPortsArray'))]",
                        "input": {
                            "name": "[concat('LBRuleForPort_', variables('lbPortsArray')[copyIndex('loadBalancingRules')])]",
                            "properties": {
                                "backendAddressPool": {
                                    "id": "[variables('derivedIds').lbPoolID]"
                                },
                                "backendPort": "[variables('lbPortsArray')[copyIndex('loadBalancingRules')]]",
                                "enableFloatingIP": false,
                                "frontendIPConfiguration": {
                                    "id": "[variables('derivedIds').lbIPConfigID]"
                                },
                                "frontendPort": "[variables('lbPortsArray')[copyIndex('loadBalancingRules')]]",
                                "idleTimeoutInMinutes": 5,
                                "probe": {
                                    "id": "[concat(variables('lbID'),'/probes/', concat('ProbForPort_', variables('lbPortsArray')[copyIndex('loadBalancingRules')]))]"
                                },
                                "protocol": "Tcp"
                            }
                        }
                    },
                    {
                        "name": "probes",
                        "count": "[length(variables('lbPortsArray'))]",
                        "input": {
                            "name": "[concat('ProbForPort_', variables('lbPortsArray')[copyIndex('probes')])]",
                            "properties": {
                                "intervalInSeconds": 5,
                                "numberOfProbes": 2,
                                "port": "[variables('lbPortsArray')[copyIndex('probes')]]",
                                "protocol": "tcp"
                            }
                        }
                    }
                ],
                "inboundNatPools": [
                    {
                        "name": "[variables('natPoolName')]",
                        "properties": {
                            "frontendIPConfiguration": {
                                "id": "[variables('derivedIds').lbIPConfigID]"
                            },
                            "frontendPortRangeStart": 50000,
                            "frontendPortRangeEnd": 50099,
                            "backendPort": 3389,
                            "protocol": "Tcp"
                        }
                    }
                ]
            },
            "tags": {
                "resourceType": "Service Fabric",
                "clusterName": "[parameters('clusterName')]",
                "displayName": "LoadBalancer"
            }
        },
        {
            "apiVersion": "[variables('apiVersion').vmssApiVersion]",
            "type": "Microsoft.Compute/virtualMachineScaleSets",
            "name": "[variables('imageConfig').vmssUniqueName]",
            "location": "[variables('location')]",
            "dependsOn": [
                "[variables('lbID')]",
                "[concat('Microsoft.Storage/storageAccounts/', variables('imageConfig').storageAccountName)]"
            ],
            "properties": {
                "overprovision": "[variables('imageConfig').overProvision]",
                "upgradePolicy": {
                    "mode": "Automatic"
                },
                "virtualMachineProfile": {
                    "networkProfile": {
                        "networkInterfaceConfigurations": [
                            {
                                "name": "[variables('nicName')]",
                                "properties": {
                                    "ipConfigurations": [
                                        {
                                            "name": "[variables('ipConfigName')]",
                                            "properties": {
                                                "loadBalancerBackendAddressPools": [
                                                    {
                                                        "id": "[variables('derivedIds').lbPoolID]"
                                                    }
                                                ],
                                                "loadBalancerInboundNatPools": [
                                                    {
                                                        "id": "[variables('derivedIds').lbNatPoolID]"
                                                    }
                                                ],
                                                "subnet": {
                                                    "id": "[variables('derivedIds').subnetID]"
                                                }
                                            }
                                        }
                                    ],
                                    "primary": true
                                }
                            }
                        ]
                    },
                    "osProfile": {
                        "adminPassword": "[parameters('adminPassword')]",
                        "adminUsername": "[parameters('adminUsername')]",
                        "computernamePrefix": "[parameters('vmNodeTypeName')]"
                    },
                    "storageProfile": {
                        "imageReference": {
                            "publisher": "[variables('imageConfig').vmImagePublisher]",
                            "offer": "[variables('imageConfig').vmImageOffer]",
                            "sku": "[parameters('vmImageSku')]",
                            "version": "[variables('imageConfig').vmImageVersion]"
                        },
                        "osDisk": {
                            "name": "[variables('imageConfig').osDiskName]",
                            "caching": "ReadOnly",
                            "createOption": "FromImage",
                            "vhdContainers": [
                                "[concat(reference(concat('Microsoft.Storage/storageAccounts/', variables('imageConfig').storageAccountName), providers('Microsoft.Storage', 'storageAccounts').apiVersions[0]).primaryEndpoints.blob, variables('imageConfig').vhdContainerName)]"
                            ]
                        }
                    },
                    "extensionProfile": {
                        "extensions": [
                            {
                                "name": "PrepareServiceFabric",
                                "properties": {
                                    "publisher": "Microsoft.Compute",
                                    "settings": {
                                        "fileUris": [
                                            "[variables('serviceFabricPrepareScriptUrl')]"
                                        ]
                                    },
                                    "protectedSettings": {
                                        "commandToExecute": "[concat('powershell -ExecutionPolicy Unrestricted -file ',variables('scriptName'), variables('commandParam'))]"
                                    },
                                    "typeHandlerVersion": "1.8",
                                    "autoUpgradeMinorVersion": true,
                                    "type": "CustomScriptExtension"
                                }
                            }
                        ]
                    }
                }
            },
            "sku": {
                "name": "[parameters('vmNodeSize')]",
                "capacity": "[parameters('instanceCount')]"
            },
            "tags": {
                "resourceType": "Service Fabric",
                "clusterName": "[parameters('clusterName')]",
                "displayName": "VMScaleSet"
            }
        },
        {
            "apiVersion": "[variables('apiVersion').templateDeploymentApiVersion]",
            "name": "DeployServiceFabric",
            "type": "Microsoft.Resources/deployments",
            "dependsOn": [
                "[concat('Microsoft.Compute/virtualMachineScaleSets/', variables('imageConfig').vmssUniqueName)]",
                "[concat('Microsoft.Storage/storageAccounts/', variables('diagStoreAccountName'))]"
            ],
            "properties": {
                "mode": "Incremental",
                "templateLink": {
                    "uri": "[variables('sfDeploymentTemplateURL')]",
                    "contentVersion": "1.0.0.0"
                },
                "parameters": {
                    "clusterName": {
                        "value": "[parameters('clusterName')]"
                    },
                    "vmScaleSetName": {
                        "value": "[variables('imageConfig').vmssUniqueName]"
                    },
                    "instanceCount": {
                        "value": "[parameters('instanceCount')]"
                    },
                    "vmNodeTypeName": {
                        "value": "[parameters('vmNodeTypeName')]"
                    },
                    "overProvision": {
                        "value": "[variables('imageConfig').overProvision]"
                    },
                    "vmImageSku": {
                        "value": "[parameters('vmImageSku')]"
                    },
                    "vmImagePublisher": {
                        "value": "[variables('imageConfig').vmImagePublisher]"
                    },
                    "vmImageOffer": {
                        "value": "[variables('imageConfig').vmImageOffer]"
                    },
                    "vmImageVersion": {
                        "value": "[variables('imageConfig').vmImageVersion]"
                    },
                    "vmNodeSize": {
                        "value": "[parameters('vmNodeSize')]"
                    },
                    "osDiskName": {
                        "value": "[variables('imageConfig').osDiskName]"
                    },
                    "vhdContainerName": {
                        "value": "[variables('imageConfig').vhdContainerName]"
                    },
                    "storageAccountName": {
                        "value": "[variables('imageConfig').storageAccountName]"
                    },
                    "diagStoreAccountName": {
                        "value": "[variables('diagStoreAccountName')]"
                    },
                    "adminUserName": {
                        "value": "[parameters('adminUserName')]"
                    },
                    "adminPassword": {
                        "value": "[parameters('adminPassword')]"
                    },
                    "nicName": {
                        "value": "[variables('nicName')]"
                    },
                    "ipConfigName": {
                        "value": "[variables('ipConfigName')]"
                    },
                    "lbPoolID": {
                        "value": "[variables('derivedIds').lbPoolID]"
                    },
                    "lbNatPoolID": {
                        "value": "[variables('derivedIds').lbNatPoolID]"
                    },
                    "subnetID": {
                        "value": "[variables('derivedIds').subnetID]"
                    },
                    "servicefabricTcpGatewayPort": {
                        "value": "[parameters('servicefabricTcpGatewayPort')]"
                    },
                    "servicefabricHttpGatewayPort": {
                        "value": "[parameters('servicefabricHttpGatewayPort')]"
                    },
                    "servicereverseProxyEndpointPort": {
                        "value": "[parameters('servicefabricReverseProxyEndpointPort')]"
                    },
                    "ephemeralStartPort": {
                        "value": "[variables('ephemeralStartPort')]"
                    },
                    "ephemeralEndPort": {
                        "value": "[variables('ephemeralEndPort')]"
                    },
                    "applicationStartPort": {
                        "value": "[variables('applicationStartPort')]"
                    },
                    "applicationEndPort": {
                        "value": "[variables('applicationEndPort')]"
                    },
                    "certBlobCloudName": {
                        "value": "[parameters('certBlobCloudName')]"
                    },
                    "certBlobAccountName": {
                        "value": "[parameters('certBlobAccountName')]"
                    },
                    "certBlobSASKey": {
                        "value": "[parameters('certBlobSASKey')]"
                    },
                    "certBlobContainerName": {
                        "value": "[parameters('certBlobContainerName')]"
                    },
                    "clusterCertificateName": {
                        "value": "[parameters('clusterCertificateName')]"
                    },
                    "clusterCertificatePassword": {
                        "value": "[parameters('clusterCertificatePassword')]"
                    },
                    "certificateStoreValue": {
                        "value": "[variables('certificateStoreValue')]"
                    },
                    "certificateThumbprint": {
                        "value": "[parameters('certificateThumbprint')]"
                    },
                    "reverseProxyCertificateName": {
                        "value": "[parameters('reverseProxyCertificateName')]"
                    },
                    "reverseProxyCertificatePassword": {
                        "value": "[parameters('reverseProxyCertificatePassword')]"
                    },
                    "reverseProxyCertificateThumbprint": {
                        "value": "[parameters('reverseProxyCertificateThumbprint')]"
                    },
                    "adminClientCertificateThumbprint": {
                        "value": "[parameters('adminClientCertificateThumbprint')]"
                    },
                    "nonAdminClientCertificateThumbprint": {
                        "value": "[parameters('nonAdminClientCertificateThumbprint')]"
                    },
                    "ClientConnectionEndpoint": {
                        "value": "[concat(reference(concat('Microsoft.Network/publicIPAddresses/', variables('lbIPName')), variables('apiVersion').publicIPApiVersion).dnsSettings.fqdn, ':', parameters('servicefabricTcpGatewayPort'))]"
                    },
                    "DNSService": {
                        "value": "[parameters('DNSService')]"
                    },
                    "RepairManager": {
                        "value": "[parameters('RepairManager')]"
                    },
                    "serviceFabricUrl": {
                        "value": "[parameters('serviceFabricUrl')]"
                    },
                    "scriptBaseUrl": {
                        "value": "[parameters('scriptBaseUrl')]"
                    }
                }
            }
        }
    ],
    "outputs": {
        "clusterMgmtEndpoint": {
            "value": "[concat('https://',reference(concat('Microsoft.Network/publicIPAddresses/', variables('lbIPName')), variables('apiVersion').publicIPApiVersion).dnsSettings.fqdn, ':', parameters('servicefabricHttpGatewayPort'), '/explorer')]",
            "type": "string"
        },
        "clientConnectionEndpoint": {
            "value": "[concat(reference(concat('Microsoft.Network/publicIPAddresses/', variables('lbIPName')), variables('apiVersion').publicIPApiVersion).dnsSettings.fqdn, ':', parameters('servicefabricTcpGatewayPort'))]",
            "type": "string"
        }
    }
}
